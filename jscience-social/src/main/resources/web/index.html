<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JScience Dashboard</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #1e1e1e; color: #fff; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        header { background: #007acc; padding: 1rem; display: flex; justify-content: space-between; align-items: center; }
        h1 { margin: 0; font-size: 1.2rem; }
        main { flex: 1; display: grid; grid-template-columns: 250px 1fr; gap: 1rem; padding: 1rem; }
        aside { background: #252526; padding: 1rem; border-radius: 4px; }
        #canvas-container { background: #000; border-radius: 4px; position: relative; overflow: hidden; }
        canvas { width: 100%; height: 100%; display: block; }
        .control-group { margin-bottom: 1rem; }
        button { background: #3e3e42; color: #fff; border: 1px solid #4e4e52; padding: 0.5rem 1rem; width: 100%; cursor: pointer; transition: background 0.2s; }
        button:hover { background: #505055; }
        button:active { background: #007acc; }
        .status { font-size: 0.8rem; color: #aaa; margin-top: 0.5rem; }
        #data-log { font-family: monospace; font-size: 0.8rem; height: 150px; overflow-y: auto; background: #111; padding: 0.5rem; margin-top: 1rem; }
    </style>
</head>
<body>
    <header>
        <h1>JScience Physics Engine</h1>
        <div id="connection-status">Disconnected</div>
    </header>
    <main>
        <aside>
            <div class="control-group">
                <button onclick="startSim()">Start Simulation</button>
            </div>
            <div class="control-group">
                <button onclick="stopSim()">Stop Simulation</button>
            </div>
            <div class="status">
                Clients Connected: <span id="client-count">0</span>
            </div>
            <div id="data-log"></div>
        </aside>
        <div id="canvas-container">
            <canvas id="simCanvas"></canvas>
        </div>
    </main>
    <script>
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');
        const log = document.getElementById('data-log');
        
        // Resize canvas
        function resize() {
            canvas.width = canvas.parentElement.clientWidth;
            canvas.height = canvas.parentElement.clientHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        // WebSocket
        let ws;
        function connect() {
            ws = new WebSocket('ws://' + location.host + '/stream');
            
            ws.onopen = () => {
                document.getElementById('connection-status').textContent = 'Connected';
                document.getElementById('connection-status').style.color = '#4ec9b0';
            };
            
            ws.onclose = () => {
                document.getElementById('connection-status').textContent = 'Disconnected';
                document.getElementById('connection-status').style.color = '#f14c4c';
                setTimeout(connect, 3000); // Reconnect
            };
            
            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);
                logData(JSON.stringify(data));
                render(data);
            };
        }
        
        function logData(text) {
            const div = document.createElement('div');
            div.textContent = text;
            log.prepend(div);
            if (log.children.length > 50) log.lastElementChild.remove();
        }
        
        // API Calls
        async function startSim() {
            await fetch('/api/simulation/start', { method: 'POST' });
        }
        
        async function stopSim() {
            await fetch('/api/simulation/stop', { method: 'POST' });
        }
        
        // Visualization
        function render(data) {
            // Echo effect
            ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Draw dummy value
            ctx.fillStyle = '#007acc';
            const y = canvas.height * (1 - data.value); // data.value is 0-1
            const x = (Date.now() / 10) % canvas.width;
            
            ctx.beginPath();
            ctx.arc(x, y, 5, 0, Math.PI * 2);
            ctx.fill();
        }

        connect();
    </script>
</body>
</html>
