groups:
  - name: jscience_alerts
    rules:
      # High pending task count
      - alert: HighPendingTasks
        expr: jscience_tasks_pending > 1000
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High pending task count"
          description: "{{ $value }} tasks pending for 5+ minutes"

      # No active workers
      - alert: NoActiveWorkers
        expr: jscience_workers_active == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "No active workers"
          description: "All workers are offline"

      # High failure rate
      - alert: HighTaskFailureRate
        expr: rate(jscience_tasks_failed[5m]) / rate(jscience_tasks_total[5m]) > 0.1
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High task failure rate"
          description: "{{ $value | humanizePercentage }} failure rate"

      # Task processing stopped
      - alert: TaskProcessingStopped
        expr: rate(jscience_tasks_completed[10m]) == 0 and jscience_tasks_pending > 0
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "Task processing stopped"
          description: "No tasks completed in 10 minutes with pending tasks"

      # Queue depth critical
      - alert: QueueDepthCritical
        expr: jscience_queue_depth > 5000
        for: 3m
        labels:
          severity: critical
        annotations:
          summary: "Queue depth critical"
          description: "Queue depth is {{ $value }}"

      # Slow task execution
      - alert: SlowTaskExecution
        expr: histogram_quantile(0.95, jscience_task_duration_seconds_bucket) > 60
        for: 10m
        labels:
          severity: warning
        annotations:
          summary: "Slow task execution"
          description: "p95 task duration is {{ $value }}s"

      # High gRPC error rate
      - alert: HighGrpcErrorRate
        expr: rate(jscience_grpc_errors_total[5m]) > 10
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "High gRPC error rate"
          description: "{{ $value }} errors/sec"

      # Worker count low
      - alert: LowWorkerCount
        expr: jscience_workers_active < 2 and jscience_tasks_pending > 100
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "Low worker count with pending tasks"
          description: "Only {{ $value }} workers active with pending work"
