# JScience Server Configuration
# ==============================

# Spring Boot Configuration
# =========================
spring.application.name=jscience-server

# Datasource (Unified DB for simplification and PostgreSQL compatibility)
spring.datasource.url=jdbc:h2:${database.dir}/jscience
spring.datasource.username=${database.username}
spring.datasource.password=${database.password}
spring.datasource.driver-class-name=${database.driver.class}

# JPA
spring.jpa.hibernate.ddl-auto=update
spring.jpa.open-in-view=false

# gRPC Server
grpc.server.port=${server.grpc.port}

# gRPC Client (Loopback for RestGateway)
grpc.client.local-server.address=static://localhost:${server.grpc.port}
grpc.client.local-server.negotiation-type=plaintext

# Actuator
management.endpoints.web.exposure.include=health,info,prometheus
management.endpoint.health.show-details=always

# Server Configuration
# --------------------
server.grpc.port=50051
server.grpc.host=0.0.0.0
server.rest.port=8080
server.rest.enabled=true
server.rest.threads=10

# Security Configuration
# ----------------------
# IMPORTANT: Override these in production with strong values via environment variables
# JWT_SECRET environment variable is required for production
security.jwt.secret=${JWT_SECRET:CHANGE_ME_IN_PRODUCTION}
security.jwt.expiration.ms=86400000
security.oidc.enabled=true

# Admin User Configuration
# -------------------------
# Set via environment variables: JSCIENCE_ADMIN_USER and JSCIENCE_ADMIN_PASSWORD
# Password must be 12+ characters and not use default values

# Database Configuration
# ----------------------
database.dir=${DATA_DIR:./data}
database.jobs.url=jdbc:h2:${database.dir}/jobs
database.users.url=jdbc:h2:${database.dir}/users
database.username=sa
database.password=
database.driver.class=org.h2.Driver
database.h2.trace=false

# External Services
# -----------------
# MLflow Tracking Server
mlflow.tracking.uri=${MLFLOW_TRACKING_URI:http://localhost:5000}
mlflow.experiment.name=${MLFLOW_EXPERIMENT:JScience}
mlflow.enabled=true

# World Bank API
worldbank.api.url=https://api.worldbank.org/v2
worldbank.cache.enabled=true
worldbank.cache.ttl.hours=24

# HTTP Client Configuration
# --------------------------
http.client.connect.timeout.ms=10000
http.client.request.timeout.ms=5000
http.client.max.connections=50
http.client.connection.pool.enabled=true

# Task Scheduling Configuration
# ------------------------------
scheduling.max.retries=3
scheduling.retry.base.delay.ms=1000
scheduling.aging.interval.ms=60000
scheduling.starvation.threshold.ms=300000

# Thread Pool Configuration
# --------------------------
executor.rest.gateway.threads=10
executor.task.processing.threads=20
executor.mlflow.threads=5

# Service Discovery (mDNS)
# -------------------------
discovery.mdns.enabled=true
discovery.mdns.service.type=_jscience._tcp.local.
discovery.mdns.service.name=JScience Server

# Logging Configuration
# ----------------------
logging.level.root=INFO
logging.level.org.jscience=DEBUG
logging.pattern=%d{yyyy-MM-dd HH:mm:ss} %-5level %logger{36} - %msg%n

# Performance Tuning
# ------------------
performance.circuit.breaker.enabled=true
performance.circuit.breaker.failure.threshold=5
performance.circuit.breaker.timeout.ms=60000
performance.rate.limiting.enabled=false

# Feature Flags
# -------------
features.caching.enabled=true
features.metrics.enabled=false
features.tracing.enabled=false

# Offline Mode
# ------------
# When enabled, skip external API calls and use cached/bundled data
offline.mode=${OFFLINE_MODE:false}
offline.fallback.enabled=true

# Storage Configuration (S3/MinIO)
# ------------------------------
storage.s3.enabled=true
storage.s3.endpoint=http://localhost:9000
storage.s3.region=us-east-1
storage.s3.access-key=${MINIO_ROOT_USER:minioadmin}
storage.s3.secret-key=${MINIO_ROOT_PASSWORD:minioadmin}
storage.s3.bucket=jscience-data

